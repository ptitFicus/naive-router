import t,{useRef as n,useState as o,useEffect as e}from"react";function u(t){return t.startsWith("{")}function s(t){return t.split("/").filter(t=>t.length>0)}class i{constructor(){this.notFound=!0,this.queue=[],this.notFoundQueue=[]}suscribe(t){t()&&(this.notFound&&this.hideNotFoundRoutes(),this.notFound=!1),this.queue.push(t)}suscribeNotFound(t){t(!this.notFound),this.notFoundQueue.push(t)}unsuscribe(t){this._unsuscribe(t,this.queue),this._unsuscribe(t,this.notFoundQueue)}_unsuscribe(t,n){const o=n.indexOf(t);-1!==o&&n.splice(o,1)}broadcast(){this.queue.reduce((t,n)=>n()||t,!1)?this.notFound&&(this.notFound=!1,this.hideNotFoundRoutes()):(this.notFound=!0,this.displayNotFoundRoutes())}hideNotFoundRoutes(){this.notFoundQueue.forEach(t=>t(!0))}displayNotFoundRoutes(){this.notFoundQueue.forEach(t=>t(!1))}}const r=Symbol();function c(i){return function({path:c,children:a}){const l=n({}),[w,p]=o(!1),[F,f]=o({}),[b,m]=o({});if(e(()=>{l.current.path=c,l.current.displayed=w},[c,w]),e(()=>{h();const t=t=>{let n=!1;const{path:o,displayed:e}=l.current;if(i)n=!t;else{const{pathname:t}=new URL(window.location.href);n=function(t,n){const o=s(t),e=s(n);return o.length===e.length&&!!o.map((t,n)=>!!u(t)||t===e[n]).reduce((t,n)=>t&&n,!0)&&e.map((t,n)=>u(o[n])?[[o[n].replace(/{|}/g,"")],t]:null).filter(t=>null!==t).reduce((t,[n,o])=>(t[n]=o,t),{})}(o,t)}return n&&!e?(p(!0),f(function(){const t=new URLSearchParams(window.location.search),n={};for(const[o,e]of t.entries())n[o]=e;return n}()),m(n)):!n&&e&&p(!1),!!n};return i?window[r].suscribeNotFound(t):window[r].suscribe(t),window.addEventListener("popstate",t),()=>{window[r].unsuscribe(t),window.removeEventListener("popstate",t)}},[]),d(a))return w?a(b,F):null;const y={...F,...b};return w?t.Children.map(a,n=>t.cloneElement(n,y)):null}}const d=t=>{const n=(t=>{return t&&{}.toString.call(t)})(t);return n&&"[object Function]"===n},h=()=>{if(!window[r]){window[r]=new i;const t=(t=>n=>{const o=Symbol();window.history[o]=window.history[n],window.history[n]=(...n)=>{window.history[o](...n),t()}})(()=>window[r].broadcast());t("pushState"),t("back"),t("forward"),t("go"),t("replaceState")}},a=c(!1),l=c(!0);export{l as NotFound,a as Route};
