import t,{useRef as e,useState as n,useEffect as o}from"react";function s(t){return t.startsWith("{")}function u(t){return t.split("/").filter(t=>t.length>0)}class i{constructor(){this.notFound=!0,this.queue=[],this.notFoundQueue=[],this.callbackScheduled=!1}suscribe(t){this.queue.push(t),this.callbackScheduled||(this.callbackScheduled=!0,this.scheduleBroadcast())}suscribeNotFound(t){this.notFoundQueue.push(t),this.callbackScheduled||(this.callbackScheduled=!0,this.scheduleBroadcast())}scheduleBroadcast(){Promise.resolve().then(()=>{this.broadcast(),this.callbackScheduled=!1})}unsuscribe(t){this._unsuscribe(t,this.queue),this._unsuscribe(t,this.notFoundQueue)}_unsuscribe(t,e){const n=e.indexOf(t);-1!==n&&e.splice(n,1)}broadcast(){this.queue.reduce((t,e)=>e()||t,!1)?this.notFound&&(this.notFound=!1,this.hideNotFoundRoutes()):(this.notFound=!0,this.displayNotFoundRoutes())}hideNotFoundRoutes(){this.notFoundQueue.forEach(t=>t(!0))}displayNotFoundRoutes(){this.notFoundQueue.forEach(t=>t(!1))}}const c=Symbol();function r(i){return function({path:r,children:a}){const l=e({}),[w,p]=n(!1),[b,f]=n({}),[F,m]=n({});if(o(()=>{l.current.path=r,l.current.displayed=w},[r,w]),o(()=>{h();const t=t=>{let e=!1;const{path:n,displayed:o}=l.current;if(i)e=!t;else{const{pathname:t}=new URL(window.location.href);e=function(t,e){const n=u(t),o=u(e);return n.length===o.length&&(!!n.map((t,e)=>!!s(t)||t===o[e]).reduce((t,e)=>t&&e,!0)&&o.map((t,e)=>s(n[e])?[[n[e].replace(/{|}/g,"")],t]:null).filter(t=>null!==t).reduce((t,[e,n])=>(t[e]=n,t),{}))}(n,t)}return e&&!o?(p(!0),f(function(){const t=new URLSearchParams(window.location.search),e={};for(const[n,o]of t.entries())e[n]=o;return e}()),m(e)):!e&&o&&p(!1),!!e};return i?window[c].suscribeNotFound(t):window[c].suscribe(t),window.addEventListener("popstate",t),()=>{window[c].unsuscribe(t),window.removeEventListener("popstate",t)}},[]),d(a))return w?a(F,b):null;const S={...b,...F};return w?t.Children.map(a,e=>t.cloneElement(e,S)):null}}const d=t=>{const e=(t=>{return t&&{}.toString.call(t)})(t);return e&&"[object Function]"===e},h=()=>{if(!window[c]){window[c]=new i;const t=(t=>e=>{const n=Symbol();window.history[n]=window.history[e],window.history[e]=(...e)=>{window.history[n](...e),t()}})(()=>window[c].broadcast());t("pushState"),t("back"),t("forward"),t("go"),t("replaceState")}},a=r(!1),l=r(!0);export{l as NotFound,a as Route};
