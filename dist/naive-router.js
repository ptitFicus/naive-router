import t,{useRef as n,useState as e,useEffect as r}from"react";function o(t){return t.startsWith("{")}function i(t){return t.split("/").filter(t=>t.length>0)}class s{constructor(){this.queue=[]}suscribe(t){this.queue.push(t)}unsuscribe(t){const n=this.queue.indexOf(t);-1!==n&&this.queue.splice(n,1)}broadcast(){this.queue.forEach(t=>t())}}const c=Symbol();function u({path:u,children:w}){const d=n({}),[h,p]=e(!1),[f,m]=e({}),[b,y]=e({});if(r(()=>{d.current.path=u,d.current.displayed=h},[u,h]),r(()=>{if(!window[c]){window[c]=new s;const t=a(()=>window[c].broadcast());t("pushState"),t("back"),t("forward"),t("go"),t("replaceState")}const t=()=>{const{path:t,displayed:n}=d.current,{pathname:e}=new URL(window.location.href),r=function(t,n){const e=i(t),r=i(n);return e.length===r.length&&!!e.map((t,n)=>!!o(t)||t===r[n]).reduce((t,n)=>t&&n,!0)&&r.map((t,n)=>o(e[n])?[[e[n].replace(/{|}/g,"")],t]:null).filter(t=>null!==t).reduce((t,[n,e])=>(t[n]=e,t),{})}(t,e);r&&!n?(p(!0),m(function(){const t=new URLSearchParams(window.location.search),n={};for(const[e,r]of t.entries())n[e]=r;return n}()),y(r)):!r&&n&&p(!1)};return window[c].suscribe(t),window.addEventListener("popstate",t),t(),()=>{window[c].unsuscribe(t),window.removeEventListener("popstate",t)}},[]),l(w))return h?w(b,f):null;const g={...f,...b};return h?t.Children.map(w,n=>t.cloneElement(n,g)):null}const a=t=>n=>{const e=Symbol();window.history[e]=window.history[n],window.history[n]=(...n)=>{window.history[e](...n),t()}},l=t=>{const n=(t=>{return t&&{}.toString.call(t)})(t);return n&&"[object Function]"===n};export{u as Route};
